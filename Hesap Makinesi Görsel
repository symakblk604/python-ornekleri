# HESAP MAKÄ°NESÄ° (Gradio + Colab + Renkli & SembollÃ¼ Butonlar)

import datetime
import pytz
import gradio as gr
import os

# ----------------- ORÄ°JÄ°NAL FONKSÄ°YONLAR -----------------
def topla(sayi1,sayi2):
    return sayi1 + sayi2

def cÄ±kar(sayi1,sayi2):
    return sayi1 - sayi2

def carp(sayi1,sayi2):
    return sayi1 * sayi2

def bolme(sayi1,sayi2):
    if sayi2 == 0:
        return "Bir sayÄ± sÄ±fÄ±ra bÃ¶lÃ¼nemez"
    else:
        return sayi1 / sayi2

def dosyaya_yaz(sayi1,operator,sayi2,sonuc):
    with open("hesap_gecmisi.txt","a") as dosya:
        locals_tz = pytz.timezone("Europe/Istanbul")
        zaman = datetime.datetime.now(locals_tz).strftime("%Y-%m-%d %H:%M:%S")
        dosya.write(f"{zaman} - {sayi1} {operator} {sayi2} = {sonuc}\n")

def dosyadan_oku():
    if os.path.exists("hesap_gecmisi.txt"):
        with open("hesap_gecmisi.txt","r") as dosya:
            gecmis = dosya.read()
            if gecmis.strip() == "":
                return "HenÃ¼z kaydedilmiÅŸ iÅŸlem yok."
            return "--- HESAP GEÃ‡MÄ°ÅÄ° ---\n" + gecmis
    else:
        return "HenÃ¼z kaydedilmiÅŸ iÅŸlem yok."

# ----------------- HESAPLA FONKSÄ°YONU -----------------
def hesapla(sayi1, sayi2, operator):
    try:
        sayi1 = float(sayi1)
        sayi2 = float(sayi2)
    except:
        return "Hata: GeÃ§ersiz giriÅŸ!", dosyadan_oku()
    
    if operator == '+':
        sonuc = topla(sayi1, sayi2)
    elif operator == '-':
        sonuc = cÄ±kar(sayi1, sayi2)
    elif operator == '*':
        sonuc = carp(sayi1, sayi2)
    elif operator == '/':
        sonuc = bolme(sayi1, sayi2)
    else:
        return "Hata: GeÃ§ersiz iÅŸlem!", dosyadan_oku()
    
    dosyaya_yaz(sayi1, operator, sayi2, sonuc)
    gecmis = dosyadan_oku()
    return sonuc, gecmis

# ----------------- Ã‡IKIÅ FONKSÄ°YONU -----------------
def cikis():
    return "Ä°ÅŸlem sonlandÄ±. TarayÄ±cÄ±yÄ± kapatabilirsiniz.", dosyadan_oku()

# ----------------- KAYITLARI TEMÄ°ZLE FONKSÄ°YONU -----------------
def kayitlari_temizle():
    if os.path.exists("hesap_gecmisi.txt"):
        os.remove("hesap_gecmisi.txt")
    return "", "KayÄ±tlar temizlendi."

# ----------------- GRADIO ARAYÃœZÃœ -----------------
with gr.Blocks() as demo:
    gr.HTML("""
    <style>
    #btn_topla {background-color:#4CAF50; color:white; font-weight:bold;}
    #btn_cikis {background-color:#f44336; color:white; font-weight:bold;}
    #btn_temizle {background-color:#FF9800; color:white; font-weight:bold;}
    </style>
    """)
    
    gr.Markdown("## ğŸ§® Hesap Makinesi (Gradio + Colab)")

    with gr.Row():
        sayi1 = gr.Textbox(label="SayÄ± 1")
        sayi2 = gr.Textbox(label="SayÄ± 2")
        operator = gr.Dropdown(choices=['+','-','*','/'], label="Ä°ÅŸlem", value='+')

    with gr.Row():
        hesapla_buton = gr.Button("â• Topla", elem_id="btn_topla")
        cikis_buton = gr.Button("âŒ Ã‡Ä±kÄ±ÅŸ", elem_id="btn_cikis")
        temizle_buton = gr.Button("ğŸ—‘ï¸ KayÄ±tlarÄ± Temizle", elem_id="btn_temizle")

    sonuc_text = gr.Textbox(label="SonuÃ§")
    gecmis_text = gr.Textbox(label="Hesap GeÃ§miÅŸi", lines=10)
    # ----------------- BUTON YAZISINI OTOMATÄ°K GÃœNCELLE -----------------
    def buton_yazi_guncelle(operator_secimi):
        if operator_secimi == '+':
            return gr.update(value="â• Topla")
        elif operator_secimi == '-':
            return gr.update(value="â– Ã‡Ä±kar")
        elif operator_secimi == '*':
            return gr.update(value="âœ– Ã‡arp")
        elif operator_secimi == '/':
            return gr.update(value="â— BÃ¶l")
        else:
            return gr.update(value="Hesapla")

    operator.change(
        fn=buton_yazi_guncelle,
        inputs=[operator],
        outputs=[hesapla_buton])

    # Butonlara fonksiyon baÄŸlama
    hesapla_buton.click(hesapla, inputs=[sayi1, sayi2, operator], outputs=[sonuc_text, gecmis_text])
    cikis_buton.click(cikis, outputs=[sonuc_text, gecmis_text])
    temizle_buton.click(kayitlari_temizle, outputs=[sonuc_text, gecmis_text])

demo.launch(share=True, prevent_thread_lock=True)
